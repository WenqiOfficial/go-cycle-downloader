<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>定时下载管理</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">定时下载管理</h3>
            </div>
            <div class="card-body">
                <!-- 消息提示区域 -->
                <div id="messageArea" class="alert alert-dismissible fade message-area" role="alert">
                    <span id="messageText"></span>
                    <button type="button" class="btn-close" title="关闭消息" onclick="hideMessage()"></button>
                </div>

                <form id="setForm">
                    <!-- 下载配置区域 -->
                    <div class="config-section mb-4">
                        <h5 class="config-title">
                            📥 下载配置
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">下载URL</label>
                                <input type="text" name="url" id="urlInput" class="form-control"
                                    placeholder="请输入文件下载地址">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">下载路径</label>
                                <input type="text" name="dir" id="dirInput" class="form-control"
                                    placeholder="如 downloads 或 D:/myfiles">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">下载限速 (KB/s)</label>
                                <input type="number" name="speed" id="speedInput" class="form-control" min="0"
                                    placeholder="0为不限速">
                            </div>

                            <hr>

                            <div class="col-12">
                                <button type="button" class="btn btn-outline-warning"
                                    id="toggleLimitBtn" onclick="toggleLimit()">
                                    📊 启用下载量限制
                                </button>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">每日下载量上限 (MB)</label>
                                <input type="number" name="limit_mb" id="limitInput" class="form-control" min="0"
                                    value="100" placeholder="每日下载量上限">
                            </div>

                        </div>
                    </div>

                    <!-- 计划配置区域 -->
                    <div class="config-section mb-4">
                        <h5 class="config-title">
                            ⏰ 自动任务
                        </h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <button type="button" class="btn btn-outline-success" id="toggleTaskBtn"
                                    onclick="toggleTask()">
                                    ▶️ 启用自动任务
                                </button>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">执行计划</label>
                                <select name="plan_type" id="planType" class="form-select" title="选择执行计划类型"
                                    onchange="togglePlanType()">
                                    <option value="interval">间隔执行</option>
                                    <option value="daily">每日执行</option>
                                </select>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6" id="intervalGroup">
                                    <label class="form-label">执行间隔（分钟）</label>
                                    <input type="number" name="interval_minutes" id="intervalInput" class="form-control"
                                        min="1" value="60" placeholder="间隔多少分钟执行一次">
                                </div>
                                <div class="col-md-6 d-none" id="hourGroup">
                                    <label class="form-label">执行时间（时）</label>
                                    <input type="number" name="hour" id="hourInput" class="form-control" min="0"
                                        max="23" value="0" title="设置执行的小时" placeholder="0-23">
                                    <small class="form-text text-muted">24小时制，0-23</small>
                                </div>
                                <div class="col-md-6 d-none" id="minuteGroup">
                                    <label class="form-label">执行时间（分）</label>
                                    <input type="number" name="minute" id="minuteInput" class="form-control" min="0"
                                        max="59" value="0" title="设置执行的分钟" placeholder="0-59">
                                    <small class="form-text text-muted">0-59</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 操作按钮区域 -->
                    <div class="config-section">
                        <h5 class="config-title">
                            ⚙️ 操作控制
                        </h5>
                        <div class="row g-2">
                            <div class="col-12 mb-2">
                                <button type="submit" class="btn btn-success">
                                    ✅ 保存设置
                                </button>
                                <button type="button" class="btn btn-primary ms-2" onclick="downloadFile()">
                                    📥 立即下载
                                </button>
                                <button type="button" class="btn btn-warning ms-2" onclick="cleanCache()">
                                    🗑️ 清理缓存
                                </button>
                                <button type="button" class="btn btn-danger ms-2" onclick="stopDownload()">
                                    ⏹️ 停止下载
                                </button>
                            </div>
                            <!-- <div class="col-12">
                                <button type="button" class="btn btn-outline-success" id="toggleTaskBtn"
                                    onclick="toggleTask()">
                                    ▶️ 启用自动任务
                                </button>
                                <button type="button" class="btn btn-outline-warning ms-2" id="toggleLimitBtn"
                                    onclick="toggleLimit()">
                                    📊 启用下载量限制
                                </button>
                            </div> -->
                        </div>
                    </div>
                </form>
                <hr>

                <div id="configStatus" class="mb-3">
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">下载目录:</span>
                            <span class="status-value" id="dirText">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">任务运行状态:</span>
                            <span class="status-value" id="taskStatus">-</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">自动任务:</span>
                            <span class="status-value" id="taskEnabled">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">执行计划:</span>
                            <span class="status-value" id="planTypeText">-</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">每日下载量限制:</span>
                            <span class="status-value" id="limitEnabled">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">每日下载量上限:</span>
                            <span class="status-value" id="limitMB">-</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">今日已下载:</span>
                            <span class="status-value" id="todayMB">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">本月已下载:</span>
                            <span class="status-value" id="monthMB">-</span>
                        </div>
                    </div>
                </div>
                <div id="downloadStatus" class="mt-3">
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">最近下载时间:</span>
                            <span class="status-value" id="lastDownload">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">最近下载文件:</span>
                            <span class="status-value" id="lastFile">-</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">下载进度:</span>
                            <span class="status-value" id="progressText">0%</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">下载速度:</span>
                            <span class="status-value" id="speedText">0 KB/s</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <span class="status-label">文件大小:</span>
                            <span class="status-value" id="sizeText">-</span>
                        </div>
                        <div class="col-md-6">
                            <span class="status-label">提示:</span>
                            <span class="status-value text-danger" id="msg">-</span>
                        </div>
                    </div>
                    <div class="progress mb-2">
                        <div id="progressBar" class="progress-bar" role="progressbar" aria-label="下载进度" title="当前下载进度">
                            0%</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="/static/js/jquery-3.7.1.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>